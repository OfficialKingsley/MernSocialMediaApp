import Head from "next/head";
import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { setPosts } from "../../state/postSlice";
import fetchPosts from "../../utils/fetchPosts";
import AddForm from "../components/AddForm";
import Container from "../components/Container";
import Posts from "../components/Posts";
import Layout from "../Layout";

const Home = () => {
  const [postsList, setPostsList] = useState([]);
  const dispatch = useDispatch();
  const userState = useSelector((state) => {
    return state.userState;
  });
  const user = userState.user;
  const token = userState.token;

  useEffect(() => {
    const getPosts = async () => {
      if (user) {
        const data = await fetchPosts(token);

        if (data?.length >= 0) {
          dispatch(setPosts(data));
          setPostsList(data);
        }
      }
    };
    getPosts();
  }, []);

  return (
    <Layout>
      <Head>
        <title>SocioMedia | Home</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="home_section flex justify-between">
        <main className="md:max-w-4xl lg:max-w-5xl grow flex flex-col items-center">
          <section className="py-4 w-full">
            <Container>
              <AddForm />
            </Container>
          </section>
          <section className="w-full">
            <Container>
              <Posts posts={postsList} />
            </Container>
          </section>
        </main>
        <aside className="border border-black hidden md:block bg-red-500 grow max-w-md">
          Omo
        </aside>
      </div>
    </Layout>
  );
};

export default Home;
